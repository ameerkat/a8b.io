<html>
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-126051187-1"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-126051187-1');
        </script>

        <title>a8b.io</title>
        <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="./index.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.css">
        <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
    </head>
    <body>
        <div class="main-wrapper">
            <div class="header-wrapper">
                <h1 class="title"><a href="index.html">a8b.io</a></h1>
                <!-- <span>Photo by <a href="https://unsplash.com/@mingjuntan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Ming Jun Tan</a> on <a href="https://unsplash.com/s/photos/big-ben?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span> -->
            </div>
            <div class="content-wrapper">
                <div class="content-header-wrapper">
                    <span class="nav-placeholder"></span>
                    <span class="social-item">Follow me on twitter <a href="https://twitter.com/AmeerNAyoub"><img src="./images/mini_me.jpg" class="mini-profile-image" />@AmeerNAyoub</a></span>
                </div>
                <div class="post column-container" id="principles-1">
                    <div class="left">
                        <div class="post-title">
                            <h1>How I got 10,000 post karma on reddit with (and without) fast.ai</h1>
                            <span class="post-date">October 30, 2020</span>
                        </div>
                        <div class="post-content">
                            <div class="figure">
                                <img src="./posts/reddit/images/reddit_badge.png" />
                                <span class="caption">Profile image made by <a href="https://ai-art.tokyo/en/">AI Gahaku</a></span>
                            </div>

                            <h2 id="motivation">Motivation</h2>
                            <p>Back in late 2006 two of my best friends and I just starting college took ENG105 at Arizona State University. The most memorable thing from that class was the textbook called "Everything's an Argument", the title of which we used as justification to argue about mundane topics in jest. A year or so later one of these friends and I put together a spreadsheet of 20 or so high-level achievements called Everything's a Contest. This includes items like "Watch the IMDB top 250 movies" (which has notably changed since then), "Photograph a live grizzly bear in the wild", and "Have something named after you" (which couldn't be done by anyone you know personally). On this list was also "Get 10,000 (post) karma on Reddit". Despite our heated discussions about what should be on this list and the criteria for success none of us ever really did anything substantial to complete any of these goals. In early 2020 I decided I should finish more of what I start, and so I decided to tackle one of these long-standing contests. But I wanted to kill two birds with one stone. I was going to do it with AI, since I wanted to apply AI to more real-life problems. I'm a huge proponent of <a href="https://www.fast.ai/">fast.ai</a> and I love the way you can tackle real problems quickly with its high-level abstractions. For someone trying to get into AI I would highly recommend using it as a framework and going through the associated materials. This is a post about how I used AI and other strategies to gain ~10,000 post karma on Reddit.</p>

                            <h2 id="approach">Approach</h2>
                            <p>Content on Reddit, in general, falls into two categories: generative (original content) and aggregative (posting found content). Trying to automate generating content to post would be implementing something like the <a href="https://imgflip.com/ai-meme">imgflip AI meme generator</a> and posting resulting content to r/memes. While the memes that are generated are an amusing juxtaposition of tropes, they generally aren't as good as memes that are generated by human users skilled in the art of observational comedy. Try the meme generator out and you'll see what I mean. At some point, I did try posting one of those just to see how well it did.</p>

                            <div class="figure">
                                <img src="./posts/reddit/images/3migr03n6m251.jpg" height="200" />
                                <span class="caption">I went through about 100 auto generated memes before I got this. This post got ~35 points with the title "An AI generated this meme. Good to know it's putting its sentience to good use."</span>
                            </div>

                            <p>The other approach would be finding content online and reposting it which I'm calling the aggregative approach. I chose this route because while generating high-quality content is more interesting it's also far more challenging and involved. With the aggregative approach, rather than being disadvantaged in that you are trying to catch up to the "human quality" of content a computer is at the advantage since the primary differentiator between posters is the ability to search through large amounts of content and speed (who finds and posts something first). In particular, I ended up looking at <i>news</i> based subreddits:</p>

                            <ul>
                                <li>There are little chances of things being a repost if you post fast enough</li>
                                <li>There are lots of quality candidates to post being generated frequently all over the internet</li>
                                <li>Tend to have large member bases</li>
                                <li>A lot of the content on the news subreddits comes from the same set of known sites that are easy to enumerate for watching and crawling</li>
                            </ul>

                            <div class="figure">
                                <iframe class="airtable-embed" src="https://airtable.com/embed/shr9FUw82wAZBoQwn?backgroundColor=cyan&viewControls=on" frameborder="0" onmousewheel="" width="100%" height="533" style="background: transparent; border: 1px solid #ccc;"></iframe>
                                <span class="caption">Domains for all the > 1 score articles from /r/business in the last week (recorded on 2020/10/29) with their counts of occurence. This illustrates how a few sites supply the majority of the content for news based subreddits with over half the articles coming from the top 5 sites.</span>
                            </div>

                            <p>I should note that I have to use my primary account for this (not using a novelty account was a requirement to accomplishing this task). At this point, I could go the spam route, and forego the need for AI at all by simply crawling certain news websites and spamming articles to relevant subreddits. In general spamming on reddit is looked down upon, thought I believe it's up to the discretion of the subreddit moderators as far as I know. While in theory I might have gotten away with it or used some sort of generic rate-limiting and hope for the best, I wanted my bot to be more like a productive member of the community submitting thoughtful content, rather than a spam bot that would be the bane of its existence until forcibly removed since I needed it to run long-term on the same account.</p>

                            <p>Specifically for news subreddits I targeted /r/business and /r/worldnews, somewhat arbitrarily and somewhat because those areas seemed interesting to me. /r/business was relatively small (577k members) and low frequency for a news subreddit so it seemed approachable as a first target. The goal was to build a web crawler to watch popular business news sites (like the ones I listed in the table above) that would leverage an NLP-based article classifier to determine if the article was worthy of being posted (had a high chance of receiving upvotes).</p>

                            <h2 id="setup">Setup</h2>
                            <h3 id="posts">Finding and loading posts</h3>
                            <p>To train the NLP model that will classify articles I need the article text for the article submitted to Reddit and their corresponding Reddit scores. Unfortunately, the official Reddit API limits the amount of historic post data you can retrieve to 1000 items. Therefore I grabbed historic posts from <a href="https://pushshift.io/">pushshift.io</a> using code I shamelessly adapted from <a href="https://www.osrsbox.com/blog/2019/03/18/watercooler-scraping-an-entire-subreddit-2007scape/">WaterCooler: Scraping an Entire Subreddit (/r/2007scape)</a>. The output file of the script has individual lines like the one below, containing a JSON object of a post per line:</p>

<pre style="white-space: pre-wrap;">{"author": "CALIPHATEMEDIA", "author_flair_css_class": null, "author_flair_text": null, "brand_safe": true, "can_mod_post": false, "contest_mode": false, "created_utc": 1514767344, "domain": "caliphatemedia.info", "full_link": "https://www.reddit.com/r/business/comments/7nc5yf/south_korea_to_regulate_bitcoin_trading_further/", "id": "7nc5yf", "is_crosspostable": false, "is_reddit_media_domain": false, "is_self": false, "is_video": false, "locked": false, "num_comments": 0, "num_crossposts": 0, "over_18": false, "parent_whitelist_status": "all_ads", "permalink": "/r/business/comments/7nc5yf/south_korea_to_regulate_bitcoin_trading_further/", "pinned": false, "retrieved_on": 1514841750, "score": 1, "selftext": "", "spoiler": false, "stickied": false, "subreddit": "business", "subreddit_id": "t5_2qgzg", "subreddit_type": "public", "thumbnail": "default", "thumbnail_height": 140, "thumbnail_width": 140, "title": "South korea to regulate bitcoin trading further with tougher measures", "url": "http://www.caliphatemedia.info/2017/12/south-korea-govt-to-introduce-tougher.html", "whitelist_status": "all_ads"}</pre>

                            <p>After generating a file with all the historic posts, I loaded the contents referenced by the "url" field of each JSON line into <a href="https://github.com/slaveofcode/boilerpipe3">boilerpipe3</a> which can transform full HTML documents into simple text.</p>

                            <div class="figure">
                                <img src="./posts/reddit/images/boilerpipe_example.png" />
                                <span class="caption">An example of how boilerpipe3 works on the reuters article <a href="https://www.reuters.com/article/us-amazon-com-results/amazon-forecasts-jump-in-holiday-sales-and-pandemic-costs-idUSKBN27E3DV">"Amazon forecasts jump in holiday sales - and pandemic costs"</a>, removing (most of) the unecessary cruft.</span>
                            </div>

                            <p>After loading the article text I did some processing to remove pages that didn't load properly and to truncate articles to ~10k characters at most.</p>

                            <h3 id="training">Training the model</h3>
                            I trained the NLP model for /r/business over a few days on approximately 271k articles from 2018-01-01 to mid-April 2020. I used an <a href="https://docs.fast.ai/text.models.awdlstm">AWD_LSTM</a> (e.g. language_model_learner(data_lm, AWD_LSTM, drop_mult=0.3) and text_classifier_learner(data, AWD_LSTM, drop_mult=0.5)) for the model with classification labels based on the score for neutral (0-10 points), okay (10-100), good (100-500), and great (500+). Note that the classes are kind of arbitrary and I've changed them around for different iterations and subreddits. The only thing I ended up paying attention to at runtime was the non-neutral class score, so this could have been a binary classifier or even better a classifier that looks at an individual article as a candidate for multiple subreddits rather than training an individual model per subreddit. For world news I had over double the number of articles, that I trained in 300k chunks due to memory limitations.

                            <h3 id="personal-aggregator">My personal business news aggregator</h3>
                            <p>I chose a few sites (Business Insider, Reuters, Bloomberg, CNN, CNBC, BBC, etc.) based on some of the frequent sites I noticed for /r/business, and plopped them into a script and built a crawler using requests and BeautifulSoup. Every minute or so I'd crawl the site root for new links and process the linked page with boilerpipe and pass it through the NLP model for scoring. New pages with a non-neutral score of greater than 0.25 (an arbitrary threshold I picked for this particular model) would be flagged and emailed to me using AWS SNS. Initially, I relied on filtering these incoming suggestions and submitting the articles myself using the Reddit app.</p>

                            <div class="figure">
                                <img src="./posts/reddit/images/example_email.png" />
                                <span class="caption">An example email I received from my site poller that I called "Reddit Postmaster".</span>
                            </div>

                            <h2 id="automation">Automation</h2>
                            <p>At this point, my site poller is acting as a personal news aggregator that I use to generate suggestions for things to post. To remove me from this loop there are a few "last mile" problems to solve. Coding up submitting via the Reddit API is easy enough, but I also need to automate gathering an appropriate title for the Reddit post and a final quality-check for the posts getting submitted. The page title is usually not good as a post title (for example containing redundancies like the site name) directly and needs to be reformatted or the title should instead be extracted from the content for example by picking the most appropriate h1 tag on the page. Rather than refining the model to be better at classifying articles and improve the accuracy of the scoring mechanism, and then coding a new component for extracting the title, I decided to try to encapsulate these tasks into a mechanical turk task and have humans as the final gate-keeper and title generator. I can take the results from these mechanical turk tasks and submit the articles to Reddit via the Reddit API utilizing those results.</p>

                            <h3 id="mturk">Mechanical Turk</h3>
                            <p>Mechanical turk is a super neat resource for leveraging humans to complete small tasks for your application. It's great for augmenting AI applications and collecting data via labeling tasks for them. But using it effectively isn't without difficulties. The important thing to know about mechanical turk is that many workers on the platform are (sensibly) optimizing for task completion quantity. When using a custom qualifier for tasks, ensure the qualification you're looking for is not apparent from the question. Similarily a bad HIT (human intelligence task) would be one where you ask the user to read an article and check some box if they think it belongs in some category. For example, I did this with /r/worldnews candidates to ensure that among other things didn't pertain to US news, however the first fully automated submission I made to /r/worldnews was "Johnson & Johnson to stop selling baby powder in the United States" which was removed after receiving 42 upvotes since US internal news is banned on /r/worldnews. Make sure the work you assign at least appears as though you will look at the individual results (e.g. use text input boxes at least once). Be careful and clear about what you're asking and reduce the opportunities for human error. Asking for the user to supply an article title, while well-intentioned results in some users writing poor article titles rather than copying the article title if they can't think of a good one. A better task would be to ask the user to identify and copy the article title as it appears in the article since that has more reliable quality.</p>

                            <div class="figure">
                                <img src="./posts/reddit/images/post_notification.png" />
                                <span class="caption">A new email letting me know when a post was submitted on my behalf.</span>
                            </div>


                            <h2 id="results">Results</h2>

                            <div class="figure">
                                <iframe class="airtable-embed" src="https://airtable.com/embed/shroixznK6muAsosc?backgroundColor=yellow&viewControls=on" frameborder="0" onmousewheel="" width="100%" height="533" style="background: transparent; border: 1px solid #ccc;"></iframe>
                                <span class="caption">All items detected and/or posted by "Reddit Postmaster".</span>
                            </div>

                            <p>You may notice that we only post a few things per day at most. In fact, our bot is probably under posting. One strategy we could adopt here would be to lower the threshold as time goes on to incentivize posting more content as each post comes with a relatively limited downside (a few downvotes then into obscurity) and a very high upside potential. While we want to avoid being spammy, our behavior is probably a little too conservative.</p>

                            <h3 id="alignment">Alignment</h3>
                            <p>The alignment problem (in AI) is when your system performs the way you told it to, for example optimizing upvotes, but it does so in a way that goes against what you actually want. For example regarding the post I referenced earlier related to US news that was posted to /r/worldnews and then removed by a moderator. While the post did get some upvotes (~42) it violated my expectation and preference that the bot would follow the rules. The problem lies in the lack of negative examples of what the bot shouldn't do. Because /r/worldnews isn't full of US news articles that are downvoted and removed for violating the rules, my bot has a lack of examples of what it shouldn't do. We could teach it the rules in the future augmenting the dataset with things that violate the rules with very negative scores. The problem of AI alignment is deeper though, as while I did identify one thing I didn't want the bot to do, there are many unstated things I also don't want the bot to do that it might do to try to optimize upvotes (for example posting photoshopped pictures, offensive content, making jokes about my mother, etc.)</p>
                            
                            <h3 id="other-means">Other means</h3>
                            <p>In total over 1.5 months of running the system on two subreddits, I was able to garner around 3.7k Reddit karma from running this automated system. Unfortunately, I never got a big hit on /r/worldnews. I got close on some occasions, such as the article about the grandma being forced to remove photos due to GDPR. However, another article covering the same thing (which later had 20k+ points) was already posted and my post was marked as being covered by another article. For the highly competetive /r/worldnews my mechanical turk tasks were taking just a little too long. This could have likely been remedied by increasing the monetary reward associated with each task. I say "around" 3.7k because the karma count for each post, in a quantum fashion, actually fluctuates slightly when you attempt to observe it. This is actually to <a href="https://www.reddit.com/r/OutOfTheLoop/comments/21id6d/why_do_number_of_downvotes_on_my_posts_fluctuate/">thwart spam bots</a>. So where did the other 6.3k come from? I got tired of waiting and went for some low hanging fruit I could tackle manually. /r/askreddit was an obvious one, coming up with an engaging question can easily get you 20k+ karma. /r/memes was an entertaining one, but difficult to breakthrough. What ended up being the winner was /r/todayilearned. I dug through "interesting facts" lists on the internet and simply found things that weren't posted and repackaged the facts.</p>                        

                            <div class="figure">
                                <img src="./posts/reddit/images/the_winning_post.png" />
                                <span class="caption">Slightly anti-climactic for ~14 years in the making.</span>
                            </div>

                            <p>Interestingly enough, even with such a large number of upvotes on a single post, all the upvotes did not count linearly towards my post karma count and I was still short some, which I was able to grind away on random subreddits (read: terrible memes and dog pictures).</p>

                            <h3 id="conclusion">Conclusion</h3>
                            <p>At the end of the day, a little bit of (concerted) manual effort beat out my months of computing time. There is no doubt that I would have automatically crossed the 10k mark and could have easily gone to any arbitrary amount given enough time running my post bot. But still I suppose this reinforces the idea you probably shouldn't go looking for problems to apply a specific tool to, other than as an exercise.</p>
                            
                        </div>
                        <div class="post-tags">
                            <ul>
                                <li>#reddit #everythings-a-contest #nlp #fast-ai</li>
                            </ul>
                        </div>
                    </div>
                    <div class="right">
                        <div class="post-toc">
                        </div>
                    </div>
                </div>

                <div class="footer">
                    <a href="./posts/index.html">See All Posts</a>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
        <script type="text/javascript">
            for (post of document.getElementsByClassName('post')) {
                const identifier = post.getAttribute("id");

                tocbot.init({
                    tocSelector: `#${identifier} .post-toc`,
                    contentSelector: `#${identifier} .post-content`,
                    headingSelector: 'h1, h2, h3',
                    hasInnerContainers: true,
                });
            }
        </script>
    </body>
</html>
